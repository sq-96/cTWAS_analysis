---
title: "SCZ - Annotation Analysis"
author: "sheng Qian"
date: "2022-4-11"
output: workflowr::wflow_html
editor_options:
  chunk_output_type: console
---

```{r}
get_E_S <- function(tissue){
  S_path <- paste0("/project2/xinhe/shengqian/cTWAS/cTWAS_analysis/data/SCZ_2018_S/",tissue,"/SCZ_",tissue)
  E_path <- paste0("/project2/xinhe/shengqian/cTWAS/cTWAS_analysis/data/SCZ_2018/",tissue,"/SCZ_",tissue)
  splicing_gene <- readRDS(paste0(S_path,"_ctwas_gene_res.RDS"))
  expression_gene <- readRDS(paste0(E_path,"_ctwas_gene_res.RDS"))
  
  return(list(splicing_gene,expression_gene))
}
```



```{r}
brain_tissue <- list.files("/project2/xinhe/shengqian/cTWAS/cTWAS_analysis/data/SCZ_2018_S/")
for(i in brain_tissue){
  results <- get_E_S(i)
  splicing_gene <- results[[1]]
  expression_gene <- results[[2]]
  expression_gene['test_id'] <- sapply(expression_gene$id, function(i){strsplit(i,"[.]")[[1]][1]})
  #print(c(length(intersect(expression_gene$test_id,splicing_gene$id)),length(intersect(expression_gene$genename,splicing_gene$genename))))
  df <- merge(expression_gene[,c("genename","susie_pip")],splicing_gene[,c("genename","susie_pip")],by = "genename")
  colnames(df) <- c("genename","Expression_PIP","Splicing_PIP")
  print(cor(df$Expression_PIP,df$Splicing_PIP))
}
```
4999

```{r}
df <- merge(expression_gene[,c("genename","susie_pip")],splicing_gene[,c("genename","susie_pip")],by = "genename")
colnames(df) <- c("genename","Expression_PIP","Splicing_PIP")
```

